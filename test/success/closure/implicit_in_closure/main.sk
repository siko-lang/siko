module Main {

implicit state: Int

fn foo(bar: Int) {
    println("state = ${state}");
}

fn main() {
    let state = 3;
    let c = with state = state {
        let b = 4;
        let c = || foo(b);
        c
    };
    c();
}

}
